plugins {
    id 'org.springframework.boot' version '2.3.2.RELEASE'
    id 'io.spring.dependency-management' version '1.0.9.RELEASE'
    id 'java-library'
}

allprojects {

    repositories {
        mavenCentral()
        jcenter()
    }

    apply plugin: 'org.springframework.boot'
    apply plugin: 'io.spring.dependency-management'
    apply plugin: 'java-library'

    /** Top level dependencies */
    dependencies {

        // Spring
        implementation 'org.springframework.boot:spring-boot-starter-web'
        implementation 'org.springframework.boot:spring-boot-starter-security'
        implementation 'org.springframework.boot:spring-boot-starter-validation'
        implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
        implementation 'org.springframework.boot:spring-boot-starter-test'
        implementation 'org.jetbrains:annotations:19.0.0'

        // Keycloak
        implementation 'org.keycloak:keycloak-spring-boot-starter'

        // MongoDB
        implementation 'org.springframework.boot:spring-boot-starter-data-mongodb'

    }

    dependencyManagement {
        imports {
            mavenBom "org.keycloak.bom:keycloak-adapter-bom:9.0.2"
        }
    }

    bootJar {
        enabled = false
    }

    jar {
        enabled = true
    }

}

subprojects {

    /** Special dependencies
     *  Inter-module dependencies are configured inside respective module's build.gradle for clarity.
     */

    if (name == "api") {
        dependencies {

            // Swagger
            implementation("io.springfox:springfox-swagger2:2.9.2")
            implementation("io.springfox:springfox-swagger-ui:2.9.2")

            // Flapdoodle
            implementation 'de.flapdoodle.embed:de.flapdoodle.embed.mongo'

        }
    }

    if (name == "end-to-end") {
        test {
            useJUnitPlatform()
        }
        dependencies {

            // Testing
            testImplementation('org.springframework.boot:spring-boot-starter-data-mongodb')
            testImplementation('org.springframework.boot:spring-boot-starter-test') {
                exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
            }

        }
    }

}